"use strict";(self.webpackChunkwallet_sign=self.webpackChunkwallet_sign||[]).push([[9870],{39870:function(e,t,n){n.r(t),n.d(t,{MessageFormatter:function(){return l},Methods:function(){return r},Operation:function(){return m.Operation},RPC_CALLS:function(){return y},RestrictedMethods:function(){return a},TokenType:function(){return m.TokenType},TransactionStatus:function(){return m.TransactionStatus},TransferDirection:function(){return m.TransferDirection},default:function(){return V},getSDKVersion:function(){return u},isObjectEIP712TypedData:function(){return g}});var r,a,s=n(43144),i=n(15671),u=function(){return"9.1.0"},o=function(e){return e.toString(16).padStart(2,"0")},c=function(){return"undefined"!==typeof window?function(e){var t=new Uint8Array((e||40)/2);return window.crypto.getRandomValues(t),Array.from(t,o).join("")}(10):(new Date).getTime().toString(36)},l=(0,s.Z)((function e(){(0,i.Z)(this,e)}));l.makeRequest=function(e,t){return{id:c(),method:e,params:t,env:{sdkVersion:u()}}},l.makeResponse=function(e,t,n){return{id:e,success:!0,version:n,data:t}},l.makeErrorResponse=function(e,t,n){return{id:e,success:!1,error:t,version:n}},function(e){e.sendTransactions="sendTransactions",e.rpcCall="rpcCall",e.getChainInfo="getChainInfo",e.getSafeInfo="getSafeInfo",e.getTxBySafeTxHash="getTxBySafeTxHash",e.getSafeBalances="getSafeBalances",e.signMessage="signMessage",e.signTypedMessage="signTypedMessage",e.getEnvironmentInfo="getEnvironmentInfo",e.getOffChainSignature="getOffChainSignature",e.requestAddressBook="requestAddressBook",e.wallet_getPermissions="wallet_getPermissions",e.wallet_requestPermissions="wallet_requestPermissions"}(r||(r={})),function(e){e.requestAddressBook="requestAddressBook"}(a||(a={}));var f=(0,s.Z)((function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,i.Z)(this,e),this.allowedOrigins=null,this.callbacks=new Map,this.debugMode=!1,this.isServer="undefined"===typeof window,this.isValidMessage=function(e){var n=e.origin,r=e.data,a=e.source,s=!r,i=!t.isServer&&a===window.parent,u="undefined"!==typeof r.version&&parseInt(r.version.split(".")[0]),o="number"===typeof u&&u>=1,c=!0;return Array.isArray(t.allowedOrigins)&&(c=void 0!==t.allowedOrigins.find((function(e){return e.test(n)}))),!s&&i&&o&&c},this.logIncomingMessage=function(e){console.info("Safe Apps SDK v1: A message was received from origin ".concat(e.origin,". "),e.data)},this.onParentMessage=function(e){t.isValidMessage(e)&&(t.debugMode&&t.logIncomingMessage(e),t.handleIncomingMessage(e.data))},this.handleIncomingMessage=function(e){var n=e.id,r=t.callbacks.get(n);r&&(r(e),t.callbacks.delete(n))},this.send=function(e,n){var r=l.makeRequest(e,n);if(t.isServer)throw new Error("Window doesn't exist");return window.parent.postMessage(r,"*"),new Promise((function(e,n){t.callbacks.set(r.id,(function(t){t.success?e(t):n(new Error(t.error))}))}))},this.allowedOrigins=n,this.debugMode=r,this.isServer||window.addEventListener("message",this.onParentMessage)})),h=f,p=n(74165),d=n(15861),g=function(e){return"object"===typeof e&&null!=e&&"domain"in e&&"types"in e&&"message"in e},m=n(82228),v=function(){function e(t){(0,i.Z)(this,e),this.communicator=t}return(0,s.Z)(e,[{key:"getBySafeTxHash",value:function(){var e=(0,d.Z)((0,p.Z)().mark((function e(t){var n;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("Invalid safeTxHash");case 2:return e.next=4,this.communicator.send(r.getTxBySafeTxHash,{safeTxHash:t});case 4:return n=e.sent,e.abrupt("return",n.data);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signMessage",value:function(){var e=(0,d.Z)((0,p.Z)().mark((function e(t){var n,a;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={message:t},e.next=3,this.communicator.send(r.signMessage,n);case 3:return a=e.sent,e.abrupt("return",a.data);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signTypedMessage",value:function(){var e=(0,d.Z)((0,p.Z)().mark((function e(t){var n;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g(t)){e.next=2;break}throw new Error("Invalid typed data");case 2:return e.next=4,this.communicator.send(r.signTypedMessage,{typedData:t});case 4:return n=e.sent,e.abrupt("return",n.data);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=(0,d.Z)((0,p.Z)().mark((function e(t){var n,a,s,i;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.txs,a=t.params,n&&n.length){e.next=3;break}throw new Error("No transactions were passed");case 3:return s={txs:n,params:a},e.next=6,this.communicator.send(r.sendTransactions,s);case 6:return i=e.sent,e.abrupt("return",i.data);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),y={eth_call:"eth_call",eth_gasPrice:"eth_gasPrice",eth_getLogs:"eth_getLogs",eth_getBalance:"eth_getBalance",eth_getCode:"eth_getCode",eth_getBlockByHash:"eth_getBlockByHash",eth_getBlockByNumber:"eth_getBlockByNumber",eth_getStorageAt:"eth_getStorageAt",eth_getTransactionByHash:"eth_getTransactionByHash",eth_getTransactionReceipt:"eth_getTransactionReceipt",eth_getTransactionCount:"eth_getTransactionCount",eth_estimateGas:"eth_estimateGas",safe_setSettings:"safe_setSettings"},b={defaultBlockParam:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"latest";return e},returnFullTxObjectParam:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e},blockNumberToHex:function(e){return Number.isInteger(e)?"0x".concat(e.toString(16)):e}},w=function(){function e(t){var n=this;(0,i.Z)(this,e),this.communicator=t,this.call=this.buildRequest({call:y.eth_call,formatters:[null,b.defaultBlockParam]}),this.getBalance=this.buildRequest({call:y.eth_getBalance,formatters:[null,b.defaultBlockParam]}),this.getCode=this.buildRequest({call:y.eth_getCode,formatters:[null,b.defaultBlockParam]}),this.getStorageAt=this.buildRequest({call:y.eth_getStorageAt,formatters:[null,b.blockNumberToHex,b.defaultBlockParam]}),this.getPastLogs=this.buildRequest({call:y.eth_getLogs}),this.getBlockByHash=this.buildRequest({call:y.eth_getBlockByHash,formatters:[null,b.returnFullTxObjectParam]}),this.getBlockByNumber=this.buildRequest({call:y.eth_getBlockByNumber,formatters:[b.blockNumberToHex,b.returnFullTxObjectParam]}),this.getTransactionByHash=this.buildRequest({call:y.eth_getTransactionByHash}),this.getTransactionReceipt=this.buildRequest({call:y.eth_getTransactionReceipt}),this.getTransactionCount=this.buildRequest({call:y.eth_getTransactionCount,formatters:[null,b.defaultBlockParam]}),this.getGasPrice=this.buildRequest({call:y.eth_gasPrice}),this.getEstimateGas=function(e){return n.buildRequest({call:y.eth_estimateGas})([e])},this.setSafeSettings=this.buildRequest({call:y.safe_setSettings})}return(0,s.Z)(e,[{key:"buildRequest",value:function(e){var t=this,n=e.call,a=e.formatters;return function(){var e=(0,d.Z)((0,p.Z)().mark((function e(s){var i,u;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a&&Array.isArray(s)&&a.forEach((function(e,t){e&&(s[t]=e(s[t]))})),i={call:n,params:s||[]},e.next=4,t.communicator.send(r.rpcCall,i);case 4:return u=e.sent,e.abrupt("return",u.data);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}]),e}(),k=n(1413),Z=n(86761),x=n(39760),_=n(31788),S="0x1626ba7e",T="0x20c13b0b",B=n(4942),P=n(97326),M=n(60136),R=n(29388),q=n(98737),C=4001,I=function(e){(0,M.Z)(n,e);var t=(0,R.Z)(n);function n(e,r,a){var s;return(0,i.Z)(this,n),(s=t.call(this,e)).code=r,s.data=a,Object.setPrototypeOf((0,P.Z)(s),n.prototype),s}return(0,s.Z)(n)}((0,q.Z)(Error)),H=function(){function e(t){(0,i.Z)(this,e),this.communicator=t}return(0,s.Z)(e,[{key:"getPermissions",value:function(){var e=(0,d.Z)((0,p.Z)().mark((function e(){var t;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.communicator.send(r.wallet_getPermissions,void 0);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requestPermissions",value:function(){var e=(0,d.Z)((0,p.Z)().mark((function e(t){var n;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isPermissionRequestValid(t)){e.next=2;break}throw new I("Permissions request is invalid",C);case 2:return e.prev=2,e.next=5,this.communicator.send(r.wallet_requestPermissions,t);case 5:return n=e.sent,e.abrupt("return",n.data);case 9:throw e.prev=9,e.t0=e.catch(2),new I("Permissions rejected",C);case 12:case"end":return e.stop()}}),e,this,[[2,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isPermissionRequestValid",value:function(e){return e.every((function(e){return"object"===typeof e&&Object.keys(e).every((function(e){return!!Object.values(a).includes(e)}))}))}}]),e}(),O=function(e,t){return t.some((function(t){return t.parentCapability===e}))},A=function(){return function(e,t,n){var r=n.value;return n.value=(0,d.Z)((0,p.Z)().mark((function e(){var n,a;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new H(this.communicator),e.next=3,n.getPermissions();case 3:if(a=e.sent,O(t,a)){e.next=8;break}return e.next=7,n.requestPermissions([(0,B.Z)({},t,{})]);case 7:a=e.sent;case 8:if(O(t,a)){e.next=10;break}throw new I("Permissions rejected",C);case 10:return e.abrupt("return",r.apply(this));case 11:case"end":return e.stop()}}),e,this)}))),n}},j=function(e,t,n,r){var a,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(a=e[u])&&(i=(s<3?a(i):s>3?a(t,n,i):a(t,n))||i);return s>3&&i&&Object.defineProperty(t,n,i),i},E=function(){function e(t){(0,i.Z)(this,e),this.communicator=t}return(0,s.Z)(e,[{key:"getChainInfo",value:function(){var e=(0,d.Z)((0,p.Z)().mark((function e(){var t;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.communicator.send(r.getChainInfo,void 0);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getInfo",value:function(){var e=(0,d.Z)((0,p.Z)().mark((function e(){var t;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.communicator.send(r.getSafeInfo,void 0);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"experimental_getBalances",value:function(){var e=(0,d.Z)((0,p.Z)().mark((function e(){var t,n,a,s,i=arguments;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},n=t.currency,a=void 0===n?"usd":n,e.next=3,this.communicator.send(r.getSafeBalances,{currency:a});case 3:return s=e.sent,e.abrupt("return",s.data);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"check1271Signature",value:function(){var e=(0,d.Z)((0,p.Z)().mark((function e(t){var n,a,s,i,u,o=arguments;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"0x",e.next=3,this.getInfo();case 3:return a=e.sent,s=(0,Z.R)({abi:[{constant:!1,inputs:[{name:"_dataHash",type:"bytes32"},{name:"_signature",type:"bytes"}],name:"isValidSignature",outputs:[{name:"",type:"bytes4"}],payable:!1,stateMutability:"nonpayable",type:"function"}],functionName:"isValidSignature",args:[t,n]}),i={call:y.eth_call,params:[{to:a.safeAddress,data:s},"latest"]},e.prev=6,e.next=9,this.communicator.send(r.rpcCall,i);case 9:return u=e.sent,e.abrupt("return",u.data.slice(0,10).toLowerCase()===S);case 13:return e.prev=13,e.t0=e.catch(6),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,this,[[6,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"check1271SignatureBytes",value:function(){var e=(0,d.Z)((0,p.Z)().mark((function e(t){var n,a,s,i,u,o=arguments;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"0x",e.next=3,this.getInfo();case 3:return a=e.sent,s=(0,Z.R)({abi:[{constant:!1,inputs:[{name:"_data",type:"bytes"},{name:"_signature",type:"bytes"}],name:"isValidSignature",outputs:[{name:"",type:"bytes4"}],payable:!1,stateMutability:"nonpayable",type:"function"}],functionName:"isValidSignature",args:[t,n]}),i={call:y.eth_call,params:[{to:a.safeAddress,data:s},"latest"]},e.prev=6,e.next=9,this.communicator.send(r.rpcCall,i);case 9:return u=e.sent,e.abrupt("return",u.data.slice(0,10).toLowerCase()===T);case 13:return e.prev=13,e.t0=e.catch(6),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,this,[[6,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"calculateMessageHash",value:function(e){return(0,x.r)(e)}},{key:"calculateTypedMessageHash",value:function(e){var t="object"===typeof e.domain.chainId?e.domain.chainId.toNumber():Number(e.domain.chainId),n=e.primaryType;if(!n){var r=Object.values(e.types),a=Object.keys(e.types).filter((function(e){return r.every((function(t){return t.every((function(t){return t.type.replace("[","").replace("]","")!==e}))}))}));if(0===a.length||a.length>1)throw new Error("Please specify primaryType");n=a[0]}return(0,_.Jv)({message:e.message,domain:(0,k.Z)((0,k.Z)({},e.domain),{},{chainId:t,verifyingContract:e.domain.verifyingContract,salt:e.domain.salt}),types:e.types,primaryType:n})}},{key:"getOffChainSignature",value:function(){var e=(0,d.Z)((0,p.Z)().mark((function e(t){var n;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.communicator.send(r.getOffChainSignature,t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isMessageSigned",value:function(){var e=(0,d.Z)((0,p.Z)().mark((function e(t){var n,r,a,s=this,i=arguments;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:"0x","string"===typeof t&&(r=function(){var e=(0,d.Z)((0,p.Z)().mark((function e(){var r,a;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.calculateMessageHash(t),e.next=3,s.isMessageHashSigned(r,n);case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),g(t)&&(r=function(){var e=(0,d.Z)((0,p.Z)().mark((function e(){var r,a;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.calculateTypedMessageHash(t),e.next=3,s.isMessageHashSigned(r,n);case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),!r){e.next=8;break}return e.next=6,r();case 6:return a=e.sent,e.abrupt("return",a);case 8:throw new Error("Invalid message type");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isMessageHashSigned",value:function(){var e=(0,d.Z)((0,p.Z)().mark((function e(t){var n,r,a,s,i,u=arguments;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=u.length>1&&void 0!==u[1]?u[1]:"0x",r=[this.check1271Signature.bind(this),this.check1271SignatureBytes.bind(this)],a=0,s=r;case 3:if(!(a<s.length)){e.next=13;break}return i=s[a],e.next=7,i(t,n);case 7:if(!e.sent){e.next=10;break}return e.abrupt("return",!0);case 10:a++,e.next=3;break;case 13:return e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getEnvironmentInfo",value:function(){var e=(0,d.Z)((0,p.Z)().mark((function e(){var t;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.communicator.send(r.getEnvironmentInfo,void 0);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requestAddressBook",value:function(){var e=(0,d.Z)((0,p.Z)().mark((function e(){var t;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.communicator.send(r.requestAddressBook,void 0);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();j([A()],E.prototype,"requestAddressBook",null);var N=(0,s.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.Z)(this,e);var n=t.allowedDomains,r=void 0===n?null:n,a=t.debug,s=void 0!==a&&a;this.communicator=new h(r,s),this.eth=new w(this.communicator),this.txs=new v(this.communicator),this.safe=new E(this.communicator),this.wallet=new H(this.communicator)})),V=N}}]);
//# sourceMappingURL=9870.98f28440.chunk.js.map